# Uncomment this in addition with the import admin_redir statement allow access to the admin interface only from local networks
{
      servers {
               trusted_proxies static private_ranges
               client_ip_headers X-Forwarded-For X-Real-IP
               # client_ip_headers CF-Connecting-IP X-Forwarded-For X-Real-IP
               # If using Cloudflare proxy, insert CF-Connecting-IP as first priority
               # since Cloudflare doesn't prevent X-Forwarded-For spoofing.
       }
}
(admin_redir) {
       @admin {
               path /admin*
               not remote_ip private_ranges
       }
       redir @admin /
}

vault.catocat.org {
  #log {
  #  level INFO
  #  output file {$LOG_FILE} {
  #    roll_size 10MB
  #    roll_keep 10
  #  }
  #}

  # Uncomment this if you want to get a cert via ACME (Let's Encrypt or ZeroSSL).
  tls equidesp@gmail.com

  # Or uncomment this if you're providing your own cert. You would also use this option
  # if you're running behind Cloudflare.
  # tls {$SSL_CERT_PATH} {$SSL_KEY_PATH}

  # This setting may have compatibility issues with some browsers
  # (e.g., attachment downloading on Firefox). Try disabling this
  # if you encounter issues.
  encode zstd gzip

  # Uncomment to improve security (WARNING: only use if you understand the implications!)
  # If you want to use FIDO2 WebAuthn, set X-Frame-Options to "SAMEORIGIN" or the Browser will block those requests
  # header / {
  #	# Enable HTTP Strict Transport Security (HSTS)
  #	Strict-Transport-Security "max-age=31536000;"
  #	# Disable cross-site filter (XSS)
  #	X-XSS-Protection "0"
  #	# Disallow the site to be rendered within a frame (clickjacking protection)
  #	X-Frame-Options "DENY"
  #	# Prevent search engines from indexing (optional)
  #	X-Robots-Tag "noindex, nofollow"
  #	# Disallow sniffing of X-Content-Type-Options
  #	X-Content-Type-Options "nosniff"
  #	# Server name removing
  #	-Server
  #	# Remove X-Powered-By though this shouldn't be an issue, better opsec to remove
  #	-X-Powered-By
  #	# Remove Last-Modified because etag is the same and is as effective
  #	-Last-Modified
  # }

  # Uncomment to allow access to the admin interface only from local networks
  import admin_redir

  # Uncomment to allow access to the admin interface only from the specified forwarded IPs (proxied Cloudflare for example)
  # @not_allowed_admin {
  #     path /admin*
  #     Trusted IPs one and two
  #     not client_ip xx.xx.xx.xx/32 xx.xx.xx.xx/32
  #     # remote_ip's forwarded mode is deprecated; client_ip matcher with global options client_ip_headers and trusted_proxies
  # }

  # respond @not_allowed_admin "401 - {http.request.header.Cf-Connecting-Ip} is not an allowed IP." 401

  # Proxy everything to Rocket
  # if located at a sub-path the reverse_proxy line will look like:
  #   reverse_proxy /vault/* 127.0.0.1:8000
  reverse_proxy 10.10.0.2:8081 {
       # Send the true remote IP to Rocket, so that Vaultwarden can put this in the
       # log, so that fail2ban can ban the correct IP.
       header_up X-Real-IP {remote_host}
       # If you use Cloudflare proxying, replace remote_host with http.request.header.Cf-Connecting-Ip
       # Not necessary if using global options 'client_ip_headers CF-Connecting-IP'
       # See https://developers.cloudflare.com/support/troubleshooting/restoring-visitor-ips/restoring-original-visitor-ips/
       # and https://caddy.community/t/forward-auth-copy-headers-value-not-replaced/16998/4
  }
}